# Sample systemd drop-in to set DATABASE_URL for homelab_copilot_agent
# Copy to /etc/systemd/system/homelab_copilot_agent.service.d/env.conf and run
#   sudo systemctl daemon-reload && sudo systemctl restart homelab_copilot_agent

[Service]
# Prefer Secrets Agent for runtime credentials. If unavailable, FALLBACK to env vars.
Environment=SECRETS_AGENT_URL=http://localhost:8088
Environment=SECRETS_AGENT_API_KEY=
# Optional fallback when Secrets Agent is not used in dev
Environment=DATABASE_URL=postgresql://postgres:postgres@eddie-postgres:5432/postgres

# Notes:
# - Store `homelab-copilot-agent` secret in the Secrets Agent with field `DATABASE_URL`.
# - Avoid hardcoding passwords. Use `scripts/secrets-agent/register-homelab-secrets.sh` to push secrets.
# - After restart, verify: curl -s http://127.0.0.1:8085/health | jq '.ipc_available, .ipc_diag'